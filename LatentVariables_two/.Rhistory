knitr::opts_chunk$set(echo = TRUE)
library(psych)
library(GGally)
library(ggrepel)
library(gridExtra)
library(polycor)
library(poLCA)
library(tidyverse)
goal_scale <- read_csv("https://raw.githubusercontent.com/chrischizinski/SNR_R_Group/master/data/goal_scale.csv")
head(goal_scale)
agoal.efa<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=4, rotation="promax", data = goal_scale )
agoal.efa
ld<-loadings(agoal.efa)
loadings<-as.data.frame(ld[,])
lt<- data.frame(indicator = paste("ags",1:12, sep =""),
latent_traits = c("MAP", "MAV", "PAP", "PAV", "MAP","MAV", "MAP", "PAV", "PAP", "PAV", "PAP", "MAV"))
loadings %>%
rownames_to_column("indicator") %>%
left_join(lt) %>%
mutate(indicator = factor(indicator, levels = paste("ags",12:1, sep =""))) %>%
gather(factor, value, -indicator, - latent_traits) %>%
mutate(value2 = ifelse(abs(value) < 0.1, NA,  value),
edge_colour = ifelse(is.na(value2), "white", "black"))-> loadings.long
ggplot(data = loadings.long) +
geom_point(aes(x = factor, y = indicator, fill = value2, shape = latent_traits, colour = edge_colour), size = 8) +
scale_colour_manual(values= c("white" = "white", "black" = "black"), guide = FALSE) +
scale_fill_gradient2(na.value = "white", mid = "blue", high = "red", low = "yellow",limits = c(-1,1.05)) +
scale_shape_manual(values = c("MAP" = 21, "MAV" = 22, "PAP" = 23, "PAV" = 24)) +
labs(fill = "Loading", shape = "Latent\ntrait") +
theme_classic()
SS_loadings<-colSums(loadings*loadings)
SS_loadings
Prop_var <- SS_loadings / nrow(loadings)
Prop_var
Cuml_var <-cumsum(Prop_var)
Cuml_var
psych::fa.parallel(goal_scale, fa="fa", fm="ml")
agoal.efa3<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_scale)
agoal.efa3
loadings3<-as.data.frame(loadings(agoal.efa3)[,])
loadings3%>%
rownames_to_column("indicator") %>%
left_join(lt) %>%
mutate(indicator = factor(indicator, levels = paste("ags",12:1, sep =""))) %>%
gather(factor, value, -indicator, - latent_traits) %>%
mutate(value2 = ifelse(value < 0.1, NA,  value),
edge_colour = ifelse(is.na(value2), "white", "black"))-> loadings3.long
ggplot(data = loadings3.long) +
geom_point(aes(x = factor, y = indicator, fill = value2, shape = latent_traits, colour = edge_colour), size = 8) +
scale_colour_manual(values= c("white" = "white", "black" = "black"), guide = FALSE) +
scale_fill_gradient2(na.value = "white", mid = "blue", high = "red", low = "yellow",limits = c(-1,1.05)) +
scale_shape_manual(values = c("MAP" = 21, "MAV" = 22, "PAP" = 23, "PAV" = 24)) +
labs(fill = "Loading", shape = "Latent\ntrait") +
theme_classic()
agoal.efa3<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_scale, scores = "Bartlett")
efa_scores <- agoal.efa3$scores %>% as.data.frame() %>% rownames_to_column("obs") %>% na.omit()
set.seed(1234)
sub_efa_scores <- efa_scores[sample(25, replace = FALSE),]
a<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor1, y = Factor2), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor1, y = Factor2, label = obs)) +
theme_classic()
b<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor2, y = Factor3), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor2, y = Factor3, label = obs)) +
theme_classic()
c<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor1, y = Factor3), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor1, y = Factor3, label = obs)) +
theme_classic()
grid.arrange(a,b,c, ncol = 3)
agoal.efa.4<-fa(goal_scale , nfactors=3, residuals=TRUE, rotate="promax",SMC=TRUE, fm="pa")
agoal.efa.4
corr_plot1<-ggcorr(data = NULL,
cor_matrix = as.data.frame(agoal.efa3$correlation),
palette = "RdGy",
label = TRUE,
label_round = 2,
label_size =4,
label_color = "black")
corr_plot1
goal_scale  %>%
na.omit() %>%
mutate_all(ordered) %>%
as.data.frame()-> goal_ordered
try(factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_ordered))
pc_goals<-hetcor(goal_ordered)
corr_plot2<-ggcorr(data = NULL,
cor_matrix = as.data.frame(pc_goals$correlation),
palette = "RdGy",
label = TRUE,
label_round = 2,
label_size =4,
label_color = "black")
grid.arrange(corr_plot1 + labs(title = "Nominal") + theme(plot.title = element_text(hjust = 1, size = 22)),
corr_plot2 + labs(title = "Ordinal") + theme(plot.title = element_text(hjust = 1, size = 22)),
ncol = 2)
agoal.efa.ordered<-fa(r=pc_goals$correlations,
nfactors=3,
residuals=TRUE, rotate="promax",SMC=TRUE, fm="pa")
agoal.efa.ordered
knitr::opts_chunk$set(echo = TRUE)
library(psych)
library(GGally)
library(ggrepel)
library(gridExtra)
library(polycor)
library(poLCA)
library(tidyverse)
goal_scale <- read_csv("https://raw.githubusercontent.com/chrischizinski/SNR_R_Group/master/data/goal_scale.csv")
head(goal_scale)
agoal.efa<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=4, rotation="promax", data = goal_scale )
agoal.efa
ld<-loadings(agoal.efa)
loadings<-as.data.frame(ld[,])
lt<- data.frame(indicator = paste("ags",1:12, sep =""),
latent_traits = c("MAP", "MAV", "PAP", "PAV", "MAP","MAV", "MAP", "PAV", "PAP", "PAV", "PAP", "MAV"))
loadings %>%
rownames_to_column("indicator") %>%
left_join(lt) %>%
mutate(indicator = factor(indicator, levels = paste("ags",12:1, sep =""))) %>%
gather(factor, value, -indicator, - latent_traits) %>%
mutate(value2 = ifelse(abs(value) < 0.1, NA,  value),
edge_colour = ifelse(is.na(value2), "white", "black"))-> loadings.long
ggplot(data = loadings.long) +
geom_point(aes(x = factor, y = indicator, fill = value2, shape = latent_traits, colour = edge_colour), size = 8) +
scale_colour_manual(values= c("white" = "white", "black" = "black"), guide = FALSE) +
scale_fill_gradient2(na.value = "white", mid = "blue", high = "red", low = "yellow",limits = c(-1,1.05)) +
scale_shape_manual(values = c("MAP" = 21, "MAV" = 22, "PAP" = 23, "PAV" = 24)) +
labs(fill = "Loading", shape = "Latent\ntrait") +
theme_classic()
SS_loadings<-colSums(loadings*loadings)
SS_loadings
Prop_var <- SS_loadings / nrow(loadings)
Prop_var
Cuml_var <-cumsum(Prop_var)
Cuml_var
psych::fa.parallel(goal_scale, fa="fa", fm="ml")
agoal.efa3<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_scale)
agoal.efa3
loadings3<-as.data.frame(loadings(agoal.efa3)[,])
loadings3%>%
rownames_to_column("indicator") %>%
left_join(lt) %>%
mutate(indicator = factor(indicator, levels = paste("ags",12:1, sep =""))) %>%
gather(factor, value, -indicator, - latent_traits) %>%
mutate(value2 = ifelse(value < 0.1, NA,  value),
edge_colour = ifelse(is.na(value2), "white", "black"))-> loadings3.long
ggplot(data = loadings3.long) +
geom_point(aes(x = factor, y = indicator, fill = value2, shape = latent_traits, colour = edge_colour), size = 8) +
scale_colour_manual(values= c("white" = "white", "black" = "black"), guide = FALSE) +
scale_fill_gradient2(na.value = "white", mid = "blue", high = "red", low = "yellow",limits = c(-1,1.05)) +
scale_shape_manual(values = c("MAP" = 21, "MAV" = 22, "PAP" = 23, "PAV" = 24)) +
labs(fill = "Loading", shape = "Latent\ntrait") +
theme_classic()
agoal.efa3<-factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_scale, scores = "Bartlett")
efa_scores <- agoal.efa3$scores %>% as.data.frame() %>% rownames_to_column("obs") %>% na.omit()
set.seed(1234)
sub_efa_scores <- efa_scores[sample(25, replace = FALSE),]
a<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor1, y = Factor2), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor1, y = Factor2, label = obs)) +
theme_classic()
b<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor2, y = Factor3), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor2, y = Factor3, label = obs)) +
theme_classic()
c<- ggplot(data = sub_efa_scores) +
geom_point(aes(x = Factor1, y = Factor3), colour = "red", alpha = 0.5) +
geom_text_repel(aes(x = Factor1, y = Factor3, label = obs)) +
theme_classic()
grid.arrange(a,b,c, ncol = 3)
agoal.efa.4<-fa(goal_scale , nfactors=3, residuals=TRUE, rotate="promax",SMC=TRUE, fm="pa")
agoal.efa.4
corr_plot1<-ggcorr(data = NULL,
cor_matrix = as.data.frame(agoal.efa3$correlation),
palette = "RdGy",
label = TRUE,
label_round = 2,
label_size =4,
label_color = "black")
corr_plot1
goal_scale  %>%
na.omit() %>%
mutate_all(ordered) %>%
as.data.frame()-> goal_ordered
try(factanal(~ags1+ags2+ags3+ags4+ags5+ags6+ags7+ags8+ags9+ags10+ags11+ ags12, factors=3, rotation="promax", data = goal_ordered))
pc_goals<-hetcor(goal_ordered)
corr_plot2<-ggcorr(data = NULL,
cor_matrix = as.data.frame(pc_goals$correlation),
palette = "RdGy",
label = TRUE,
label_round = 2,
label_size =4,
label_color = "black")
grid.arrange(corr_plot1 + labs(title = "Nominal") + theme(plot.title = element_text(hjust = 1, size = 22)),
corr_plot2 + labs(title = "Ordinal") + theme(plot.title = element_text(hjust = 1, size = 22)),
ncol = 2)
agoal.efa.ordered<-fa(r=pc_goals$correlations,
nfactors=3,
residuals=TRUE, rotate="promax",SMC=TRUE, fm="pa")
agoal.efa.ordered
